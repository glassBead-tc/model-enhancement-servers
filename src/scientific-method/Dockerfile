# Generated by https://smithery.ai. See: https://smithery.ai/docs/config#dockerfile
# Build stage
FROM node:lts-alpine AS builder
WORKDIR /app

# Copy project files and source
COPY package.json package-lock.json tsconfig.json ./
COPY src ./src

# Install dependencies without running lifecycle scripts
RUN npm ci --ignore-scripts

# Build only the scientific-method workspace
RUN npm run build --workspace=@waldzellai/scientific-method

# Runtime stage
FROM node:lts-alpine AS runtime
WORKDIR /app

# Copy built artifacts and dependencies
COPY --from=builder /app/src/scientific-method/dist ./dist
COPY --from=builder /app/node_modules ./node_modules
COPY src/scientific-method/package.json ./package.json

ENV NODE_ENV=production

# Start the MCP server
ENTRYPOINT ["node", "dist/index.js"]
